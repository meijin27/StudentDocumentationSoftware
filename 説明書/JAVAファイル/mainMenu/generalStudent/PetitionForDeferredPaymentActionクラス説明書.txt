PetitionForDeferredPaymentAction クラスに関する説明書

1. 概要
このクラスは、学費延納願のPDFを作成し、ダウンロードします。

2. 主要な処理ステップ:
① セッションの確認: ユーザーのIDとマスターキーがセッションに存在するか確認します。
② 入力値の取得: 入力値を取得します。
③ バリデーション: 取得した入力値のバリデーションを実施します。
④ データの復号化: マスターキーを使用してデータベースから取り出したデータを復号化します。
⑤ 自動入力：データベースに登録済みの情報（名前等）は自動で記入します。
⑥ 操作ログの追加: 学費延納願の発行をデータベースの操作ログに追加します。

3. 詳細:
① セッションの確認: セッションのidとmaster_keyが存在しない場合、エラーメッセージをセットし、ログインページにリダイレクトします。
② 入力値の取得: リクエストからデータベースに要録していないデータ（申請日等）の値を取得します。
③ 必須項目に不備がある場合、エラーメッセージをセットします。
	・年月日が存在しない日付（例：2月31日）の場合、エラーメッセージをセットします。
	・延納理由が64文字を超える場合、エラーメッセージをセットします。
	・入力必須項目に未入力項目がある場合、エラーメッセージをセットします。
	・入力金額に数字以外が含まれている、もしくは数字が１０００万を超過した場合はエラーメッセージをセットします。
	・納付すべき金額と納付学費及び延納金額の合計が一致しない場合、エラーメッセージをセットします。
	・納付期限が土日の場合、エラーメッセージをセットします。
	・納付期限が願出年月日より前の場合、エラーメッセージをセットします。
	・学生種別が留学生の場合、かつ母国からの送金有無や理由等が未入力の場合、エラーメッセージをセットします。
	（データベースから学生種別入手）
	（留学生でない学生が留学生の項目を入力した場合、入力値を無視する）
	・いずれかのエラーメッセージがセットされた場合、元のページに戻ります。
④ データの復号化: データベースから取り出したデータは共通の暗号キーを使用して復号化します。その後、Decryptクラスを使用してセッションからマスターキー、IV、ユーザーIDを取得します。取得したマスターキーとIVを使用して、データを再度復号化します。
⑤ 学籍番号・氏名・クラス名・学年・クラス番号をデータベースから取り出し、自動でPDFに記入します。
➅ 操作ログの追加: 学費延納願の発行をデータベースの操作ログに追加します。

4. 例外処理:
もしデータベースへのアクセスや暗号化処理中に例外が発生した場合、エラーメッセージをログに記録し、エラーメッセージをリクエストにセットして、元のページに戻ります。

5. 終了処理:
すべての処理が正常に終了した場合、PDFがダウンロードされます。画面遷移は行われません。