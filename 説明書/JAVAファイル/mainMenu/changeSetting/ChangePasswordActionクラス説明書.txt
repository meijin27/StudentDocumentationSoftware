ChangePasswordAction クラスに関する説明書

1. 概要
このクラスは、ユーザーのパスワードを変更するアクションを定義しています。このアクションは、特定のフォームデータを受け取り、バリデーションを実施した後、ユーザーデータベースを更新します。

2. 主要な処理ステップ:
①セッションの確認: ユーザーのIDとマスターキーがセッションに存在するか確認します。
②入力値の取得: 現在のパスワード、新しいパスワード、再確認用パスワードをリクエストから取得します。
③バリデーション: 取得した入力値のバリデーションを実施します。
④データベースのパスワード一致確認: 現在のパスワードがデータベースのものと一致するか確認します。
⑤パスワードの更新: データベースにユーザーの新しいパスワードを更新します。
⑥操作ログの追加: パスワードの変更をデータベースの操作ログに追加します。

3. 詳細:
①セッションの確認: セッションのidとmaster_keyが存在しない場合、エラーメッセージをセットし、ログインページにリダイレクトします。
②入力値の取得: リクエストから現在のパスワード (password), 新しいパスワード (newPassword), 再確認用パスワード (passwordCheck) の値を取得します。
③バリデーション:
	・パスワードや新しいパスワードが未入力の場合、エラーメッセージをセットします。
	・新しいパスワードと再確認用パスワードが一致しない場合、エラーメッセージをセットします。
	・パスワードや新しいパスワードが32文字を超える場合、エラーメッセージをセットします。
④データベースのパスワード一致確認: ユーザーIDを元にデータベースから登録されているパスワードを取得し、入力された現在のパスワードと比較します。
⑤パスワードの更新: 新しいパスワードをハッシュ化し、データベースに更新します。マスターキーも新しいパスワードを元に更新します。
⑥操作ログの追加: ユーザーIDを元に、データベースの操作ログに「Change Password」という操作を追加します。

4. 例外処理:
データベースへのアクセスや暗号化処理中に例外が発生した場合、エラーメッセージをログに記録し、エラーメッセージをリクエストにセットして、元のページに戻ります。

5. 終了処理:
すべての処理が正常に終了した場合、成功メッセージをセットして、成功画面に遷移します。